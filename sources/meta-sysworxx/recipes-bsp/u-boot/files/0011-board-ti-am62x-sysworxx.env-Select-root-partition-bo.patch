From 58c452f571b5557fa4ea091b24d57d11411a34fc Mon Sep 17 00:00:00 2001
From: Andreas Dinter <andreas.dinter@systec-electronic.com>
Date: Wed, 21 Aug 2024 10:21:54 +0200
Subject: [PATCH 11/13] board/ti/am62x/sysworxx.env: Select root partition
 (bootpart) dynamically

Signed-off-by: Andreas Dinter <andreas.dinter@systec-electronic.com>
---
 board/ti/am62x/sysworxx.env       | 9 ++++++++-
 configs/am625_sysworxx_a53.config | 1 +
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/board/ti/am62x/sysworxx.env b/board/ti/am62x/sysworxx.env
index 6b4eefa2a43..ecdfdec1fdd 100644
--- a/board/ti/am62x/sysworxx.env
+++ b/board/ti/am62x/sysworxx.env
@@ -23,7 +23,6 @@ run_kern=booti ${loadaddr} ${rd_spec} ${fdtaddr}
 
 boot_targets=mmc1 mmc0 usb pxe dhcp
 boot=mmc
-bootpart=1:2
 bootdir=/boot
 rd_spec=-
 
@@ -47,6 +46,14 @@ eeprom_export=
 	i2c write 0x88080100 0x51 0x0.1 0x100;
 	echo "vendor data exported"
 
+mmc_detect=
+	mmc dev ${mmcdev};
+	if test ${mmcdev} -eq 1; then
+		env set bootpart 1:2;
+	else
+		env set bootpart 0:1;
+	fi
+
 rproc_fw_binaries= 0 /lib/firmware/am62-mcu-m4f0_0-fw
 
 #if CONFIG_BOOTMETH_ANDROID
diff --git a/configs/am625_sysworxx_a53.config b/configs/am625_sysworxx_a53.config
index a07a69ade7e..babe2e8bc12 100644
--- a/configs/am625_sysworxx_a53.config
+++ b/configs/am625_sysworxx_a53.config
@@ -2,3 +2,4 @@
 
 CONFIG_TARGET_SYSWORXX_AM62X_ADOPT=y
 CONFIG_ENV_SOURCE_FILE="sysworxx"
+CONFIG_BOOTCOMMAND="run mmc_detect; run distro_bootcmd;"
-- 
2.47.0

