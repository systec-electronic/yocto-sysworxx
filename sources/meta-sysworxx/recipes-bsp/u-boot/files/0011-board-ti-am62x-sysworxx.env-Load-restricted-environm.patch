From 2f810fff4e8dc8d28648094009a6e5571faf7d7b Mon Sep 17 00:00:00 2001
From: Andreas Dinter <andreas.dinter@systec-electronic.com>
Date: Sat, 22 Feb 2025 16:07:58 +0100
Subject: [PATCH] board/ti/am62x/sysworxx.env: Load restricted environment from
 eMMC boot partition

Signed-off-by: Andreas Dinter <andreas.dinter@systec-electronic.com>
---
 board/ti/am62x/sysworxx.env       | 8 ++++++++
 configs/am625_sysworxx_a53.config | 2 ++
 2 files changed, 10 insertions(+)

diff --git a/board/ti/am62x/sysworxx.env b/board/ti/am62x/sysworxx.env
index 821dafc5872..c7e9d200eb3 100644
--- a/board/ti/am62x/sysworxx.env
+++ b/board/ti/am62x/sysworxx.env
@@ -61,8 +61,16 @@ mmc_detect=
 		env set root_mmc "/dev/mmcblk${mmcdev}p1";
 	fi
 
+env_import=
+	read mmc 0:2  0x88080000 0 32;
+	env import -c 0x88080000 0x4000 name_overlays;
+env_export=
+	env export -c -s 0x4000 0x88080000 name_overlays;
+	write mmc 0:2 0x88080000 0 32;
+
 bootcmd_sysworxx=
 	run mmc_detect;
+	run env_import;
 	run findfdt;
 	run bootcmd_ti_mmc;
 
diff --git a/configs/am625_sysworxx_a53.config b/configs/am625_sysworxx_a53.config
index 60aa63495df..178c53e2f61 100644
--- a/configs/am625_sysworxx_a53.config
+++ b/configs/am625_sysworxx_a53.config
@@ -3,3 +3,5 @@
 CONFIG_TARGET_SYSWORXX_AM62X_ADOPT=y
 CONFIG_ENV_SOURCE_FILE="sysworxx"
 CONFIG_BOOTCOMMAND="run bootcmd_sysworxx;"
+CONFIG_CMD_READ=y
+CONFIG_CMD_WRITE=y
-- 
2.48.1

