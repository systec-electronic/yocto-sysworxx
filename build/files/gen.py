#!/usr/bin/env python

# ATTENTION!: Only append to the following constants!
#             Otherwise RAUC updates may cause corrupt file system permissions.

USERS = {
    # WARNING ... system username "..." does not have a static ID defined
    "root": 0,
    "daemon": 1,
    "bin": 2,
    "sys": 3,
    "sync": 4,
    "games": 5,
    "man": 6,
    "lp": 7,
    "mail": 8,
    "news": 9,
    "uucp": 10,
    "proxy": 13,
    "postgres": 28,
    "www-data": 33,
    "backup": 34,
    "list": 38,
    "irc": 39,
    "_apt": 42,
    "polkitd": 200,
    "dovecot": 201,
    "dovenull": 202,
    "avahi-autoipd": 203,
    "avahi": 204,
    "bind": 205,
    "builder": 206,
    "colord": 207,
    "cyrus": 208,
    "dhcpcd": 209,
    "distcc": 210,
    "radiusd": 211,
    "frr": 212,
    "gdm": 213,
    "influxdb": 214,
    "qemu": 215,
    "lldpd": 216,
    "mysql": 217,
    "mosquitto": 218,
    "mpd": 219,
    "nm-fortisslvpn": 220,
    "nm-openconnect": 221,
    "nm-openvpn": 222,
    "rpcuser": 223,
    "ntp": 224,
    "opensaf": 225,
    "pcpqa": 226,
    "pcp": 227,
    "pipewire": 228,
    "postfix": 229,
    "vmail": 230,
    "ppp": 232,
    "ftp": 233,
    "ptest": 234,
    "pulse": 235,
    "radvd": 236,
    "rauc-hawkbit": 237,
    "redis": 238,
    "rpc": 239,
    "rtkit": 240,
    "sanlock": 241,
    "squid": 242,
    "tinyproxy": 243,
    "xrdp": 244,
    "zabbix": 245,
    "systemd-timesync": 996,
    "systemd-resolve": 997,
    "sshd": 998,
    "messagebus": 999,
    "nobody": 65534,
    # WARNING ... normal username "..." does not have a static ID defined
    "xuser": 2000,
    "123456-fsgqa": 2001,
    "fsgqa": 2002,
    "fsgqa2": 2003,
    "weston": 2004,
}

GROUPS = {
    # WARNING ... system groupname "..." does not have a static ID defined
    "root": 0,
    "daemon": 1,
    "bin": 2,
    "sys": 3,
    "adm": 4,
    "tty": 5,
    "disk": 6,
    "lp": 7,
    "mail": 8,
    "news": 9,
    "uucp": 10,
    "man": 12,
    "proxy": 13,
    "kmem": 15,
    "input": 19,
    "dialout": 20,
    "fax": 21,
    "voice": 22,
    "cdrom": 24,
    "floppy": 25,
    "tape": 26,
    "sudo": 27,
    "postgres": 28,
    "audio": 29,
    "dip": 30,
    "www-data": 33,
    "backup": 34,
    "operator": 37,
    "list": 38,
    "irc": 39,
    "src": 40,
    "shadow": 42,
    "utmp": 43,
    "video": 44,
    "sasl": 45,
    "plugdev": 46,
    "kvm": 47,
    "sgx": 48,
    "staff": 50,
    "games": 60,
    "shutdown": 70,
    "wheel": 80,
    "users": 100,
    "crontab": 200,
    "datetime": 201,
    "docker": 202,
    "dovecot": 203,
    "dovenull": 204,
    "frr": 205,
    "frrvty": 206,
    "ftp": 207,
    "lldpd": 208,
    "lpadmin": 209,
    "mysql": 210,
    "network": 211,
    "nogroup": 212,
    "opensaf": 213,
    "pipewire": 214,
    "postdrop": 215,
    "postfix": 216,
    "pulse": 218,
    "qemu": 219,
    "redis": 220,
    "sanlock": 221,
    "vmail": 222,
    "wayland": 223,
    "weston-launch": 224,
    "xrdp": 225,
    "zabbix": 226,
    "mosquitto": 227,
    "ptest": 228,
    "systemd-timesync": 994,
    "systemd-resolve": 995,
    "systemd-journal": 996,
    "render": 997,
    "sshd": 998,
    "messagebus": 999,
    "nobody": 65534,
    # WARNING ... normal groupname "..." does not have a static ID defined
    "tracing": 2001,
}

with open("passwd", "w", encoding="utf-8") as f:
    used_uids = {}
    f.write("## do not edit manually, this is auto-generated by gen.py\n")
    f.write("\n")

    for username, uid in USERS.items():
        if uid in used_uids:
            raise ValueError(
                f"Attempt to add user '{username}' with uid '{uid}' which is already used for '{used_uids[uid]}'"
            )
        used_uids[uid] = username

        f.write(f"{username}:!:{uid}\n")

with open("group", "w", encoding="utf-8") as f:
    used_gids = {}
    f.write("## do not edit manually, this is auto-generated by gen.py\n")
    f.write("\n")

    for groupname, gid in GROUPS.items():
        if gid in used_gids:
            raise ValueError(
                f"Attempt to add group '{groupname}' with gid '{gid}' which is already used for '{used_gids[gid]}'"
            )
        used_gids[gid] = groupname

        f.write(f"{groupname}:!:{gid}\n")
