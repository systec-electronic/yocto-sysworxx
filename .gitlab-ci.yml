---
default:
  image: ${CI_REGISTRY}/132335/sw/yocto-builder:latest
  tags: [docker, yocto]

variables:
  FF_DISABLE_UMASK_FOR_DOCKER_EXECUTOR: true
  GIT_SUBMODULE_STRATEGY: recursive
  GIT_DEPTH: 0
  # don't clean Yocto build/tmp directory per default
  GIT_CLEAN_FLAGS: -ffdx -e build/

stages:
  - build

before_script:
  - echo 'DL_DIR="/cache/downloads"' >> ./build/conf/local.conf
  - echo 'SSTATE_DIR="/cache/sstate-cache"' >> ./build/conf/local.conf

sysworxx-image-default-ctr:
  stage: build
  script: |
    cd build/
    . conf/setenv
    bitbake sysworxx-image-default
    cp deploy-ti/images/sysworxx-ctr/sysworxx-image-default-sysworxx-ctr.wic.xz ..
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG-$CI_COMMIT_SHORT_SHA"
    when: on_success
    expire_in: 1 week
    paths:
      - "*.wic.xz"
